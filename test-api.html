<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - L-Tec Solutions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-card {
            margin-bottom: 20px;
        }
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .log-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">L-Tec Solutions API Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card status-card">
                    <div class="card-header">
                        <h5>Connection Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="backendStatus">
                            <span class="status-indicator status-warning"></span>
                            <span>Backend: Checking...</span>
                        </div>
                        <div id="whatsappStatus">
                            <span class="status-indicator status-warning"></span>
                            <span>WhatsApp: Checking...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card status-card">
                    <div class="card-header">
                        <h5>Test Form Submission</h5>
                    </div>
                    <div class="card-body">
                        <button id="testSubmit" class="btn btn-primary" disabled>
                            Test Form Submission
                        </button>
                        <div id="testResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>Test Log</h5>
            </div>
            <div class="card-body">
                <div id="logContainer" class="log-container">
                    <div>Starting API test...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script>
        const logContainer = document.getElementById('logContainer');
        const backendStatus = document.getElementById('backendStatus');
        const whatsappStatus = document.getElementById('whatsappStatus');
        const testSubmit = document.getElementById('testSubmit');
        const testResult = document.getElementById('testResult');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(element, status, message) {
            const indicator = element.querySelector('.status-indicator');
            const text = element.querySelector('span:last-child');
            
            indicator.className = `status-indicator status-${status}`;
            text.textContent = message;
        }

        async function testConnection() {
            log('Testing backend connection...');
            
            try {
                const status = await APIUtils.getConnectionStatus();
                
                if (status.backend) {
                    updateStatus(backendStatus, 'success', 'Backend: Connected');
                    log('✓ Backend connection successful');
                } else {
                    updateStatus(backendStatus, 'error', 'Backend: Not available');
                    log('✗ Backend connection failed: ' + (status.errors.backend || 'Unknown error'));
                }
                
                if (status.whatsapp) {
                    updateStatus(whatsappStatus, 'success', 'WhatsApp: Ready');
                    log('✓ WhatsApp client is ready');
                } else {
                    updateStatus(whatsappStatus, 'warning', 'WhatsApp: Not ready');
                    log('⚠ WhatsApp client not ready: ' + (status.errors.whatsapp || 'Unknown error'));
                }
                
                // Enable test button if backend is available
                if (status.backend) {
                    testSubmit.disabled = false;
                    log('Test form submission enabled');
                }
                
            } catch (error) {
                log('✗ Connection test failed: ' + error.message);
                updateStatus(backendStatus, 'error', 'Backend: Error');
                updateStatus(whatsappStatus, 'error', 'WhatsApp: Error');
            }
        }

        async function testFormSubmission() {
            log('Testing form submission...');
            testSubmit.disabled = true;
            testSubmit.textContent = 'Testing...';
            
            const testData = {
                name: 'Test User',
                email: 'test@example.com',
                phone: '+1234567890',
                product: 'Gaming PC Pro',
                quantity: 1,
                message: 'This is a test submission from the API test page.'
            };
            
            try {
                const result = await APIUtils.submitProductInquiry(testData);
                
                if (result.success) {
                    testResult.innerHTML = '<div class="alert alert-success">✓ Form submission successful! Message sent to business WhatsApp (+94771461925)</div>';
                    log('✓ Form submission test passed - message sent to business number only');
                } else {
                    testResult.innerHTML = '<div class="alert alert-danger">✗ Form submission failed: ' + result.error + '</div>';
                    log('✗ Form submission test failed: ' + result.error);
                }
            } catch (error) {
                testResult.innerHTML = '<div class="alert alert-danger">✗ Form submission error: ' + error.message + '</div>';
                log('✗ Form submission test error: ' + error.message);
            } finally {
                testSubmit.disabled = false;
                testSubmit.textContent = 'Test Form Submission';
            }
        }

        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            log('API Test page loaded');
            testConnection();
            
            testSubmit.addEventListener('click', testFormSubmission);
        });
    </script>
</body>
</html>
